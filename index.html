<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PDF Generator</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    input, button { margin: 10px 0; display: block; }
  </style>
</head>
<body>
  <h1>Generate PDF from JSON</h1>

  <label>Select JSON file:</label>
  <input type="file" id="jsonFile" accept=".json" />

  <label>Select included images (optional):</label>
  <input type="file" id="imageFiles" multiple accept="image/*" />

  <button id="generateBtn">Generate PDF</button>

  <div id="status"></div>

  <script>
    const SERVER_URL = "http://127.0.0.1:8000"; // Update if deployed

    document.getElementById("generateBtn").addEventListener("click", async () => {
      const status = document.getElementById("status");
      status.textContent = "Uploading files...";

      const jsonFile = document.getElementById("jsonFile").files[0];
      const imageFiles = document.getElementById("imageFiles").files;

      if (!jsonFile) {
        status.textContent = "Please select a JSON file!";
        return;
      }

      const formData = new FormData();
      formData.append("files", jsonFile);

      for (let i = 0; i < imageFiles.length; i++) {
        formData.append("files", imageFiles[i]);
      }

      try {
        const res = await fetch(`${SERVER_URL}/generate-pdf/`, {
            method: "POST",
            body: formData
            });

            if (!res.ok) {
            const err = await res.json();
            status.textContent = "Error: " + (err.error || res.statusText);
            return;
            }

            const blob = await res.blob();
            const url = URL.createObjectURL(blob);

            // Open PDF in new tab
            window.open(url);
            status.textContent = "PDF generated successfully!";

      } catch (e) {
        status.textContent = "Request failed: " + e;
      }
    });
  </script>
</body>
</html>
