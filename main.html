<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Data Acquisition Form</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        .section { margin-bottom: 20px; padding: 10px; border: 1px solid #ccc; }
        .source { margin-top: 10px; padding: 10px; border: 1px dashed #999; }
        button { margin-top: 10px; }
        textarea { width: 100%; height: 200px; }
    </style>
</head>
<body>
<h1>Data Acquisition Form</h1>

<div class="section">
    <h2>General Information</h2>
    <label>Name: <input type="text" id="name" /></label><br />
    <label>Description: <input type="text" id="description" /></label><br />
    <label>Procedure Number: <input type="text" id="procedureNumber" /></label><br />
    <label>Facility: <input type="text" id="facility" /></label><br />
    <label>Location: <input type="text" id="location" /></label><br />
    <label>Revision: <input type="text" id="revision" /></label><br />
    <label>Date: <input type="date" id="date" /></label><br />
    <label>Origin: <input type="text" id="origin" /></label><br />
    <label>Machine Image: <input type="text" id="machineImage" /></label><br />
    <label>Isolation Points: <input type="text" id="isolationPoints" /></label><br />
    <label>Notes: <input type="text" id="notes" /></label><br />
    <label>Prepared By: <input type="text" id="preparedBy" /></label><br />
    <label>Approved By: <input type="text" id="approvedBy" /></label><br />
    <label>Approved By Company: <input type="text" id="approvedByCompany" /></label><br />
    <label>Completed Date: <input type="date" id="completedDate" /></label>
</div>

<div class="section">
    <h2>Energy Sources (max 8)</h2>
    <div id="sources"></div>
    <button onclick="addSource()">Add Source</button>
</div>

<button onclick="generateJSON()">Generate JSON</button>

<h2>Output</h2>
<textarea id="output"></textarea>

<script>
    let sourceCount = 0;

    function addSource() {
        if (sourceCount >= 8) {
            alert("Max 8 sources allowed");
            return;
        }

        const container = document.getElementById("sources");
        const div = document.createElement("div");
        div.className = "source";
        div.innerHTML = `
        <h3>Source ${sourceCount + 1}</h3>
        <label>Energy Source: <input type="text" class="EnergySource" /></label><br />
        <label>Chemical Name: <input type="text" class="ChemicalName" /></label><br />
        <label>VOLTS: <input type="text" class="VOLTS" /></label><br />
        <label>PSI: <input type="text" class="PSI" /></label><br />
        <label>LBS: <input type="text" class="LBS" /></label><br />
        <label>TEMP: <input type="text" class="TEMP" /></label><br />
        <label>Device: <input type="text" class="Device" /></label><br />
        <label>Tag: <input type="text" class="Tag" /></label><br />
        <label>Description: <input type="text" class="Description" /></label><br />
        <label>Isolation Point: <input type="text" class="IsolationPoint" /></label><br />
        <label>Isolation Method: <input type="text" class="IsolationMethod" /></label><br />
        <label>Verification Method: <input type="text" class="VerificationMethod" /></label><br />
        <label>Verification Device: <input type="text" class="VerificationDevice" /></label><br />
      `;
        container.appendChild(div);
        sourceCount++;
    }

    function generateJSON() {
        const obj = {
            Description: getVal("description"),
            ProcedureNumber: getVal("procedureNumber"),
            Facility: getVal("facility"),
            Location: getVal("location"),
            Revision: getVal("revision"),
            Date: getVal("date"),
            Origin: getVal("origin"),
            MachineImage: getVal("machineImage"),
            IsolationPoints: getVal("isolationPoints"),
            Notes: getVal("notes"),
            ApprovedBy: getVal("approvedBy"),
            PreparedBy: getVal("preparedBy"),
            ApprovedByCompany: getVal("approvedByCompany"),
            CompletedDate: getVal("completedDate"),
            Sources: []
        };

        const sourceDivs = document.querySelectorAll(".source");
        sourceDivs.forEach(div => {
            const s = {};
            div.querySelectorAll("input").forEach(input => {
                s[input.className] = input.value;
            });
            obj.Sources.push(s);
        });

        const jsonStr = JSON.stringify(obj, null, 2);
        document.getElementById("output").value = jsonStr;

        // Get filename from "Name" field
        const filename = getVal("name")?.trim() || "data";
        downloadJSON(jsonStr, `${filename}.json`);
    }

    function getVal(id) {
        return document.getElementById(id).value;
    }

    function downloadJSON(content, fileName) {
        const blob = new Blob([content], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = fileName;
        a.click();
        URL.revokeObjectURL(url);
    }
</script>
</body>
</html>