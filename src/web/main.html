<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Data Acquisition Form</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f7f7f7;
        margin: 0;
        padding: 0;
    }

    header {
        background-color: #C32026;
        color: white;
        padding: 20px 0;
        text-align: center;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    h1 {
        margin: 0;
        font-size: 2em;
    }

    main {
        max-width: 800px;
        margin: 20px auto;
        padding: 0 10px;
    }

    .section {
        background-color: white;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .section h2 {
        margin-top: 0;
    }

    label {
        display: block;
        margin-bottom: 8px;
    }

    input, textarea {
        width: 100%;
        padding: 6px 10px;
        margin-top: 2px;
        margin-bottom: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
    }

    textarea {
        height: 200px;
    }

    .source {
        margin-top: 10px;
        padding: 10px;
        border: 1px dashed #999;
        position: relative;
    }

    .source-header {
        font-weight: bold;
        margin-bottom: 10px;
    }

    button {
        background-color: #C32026;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 6px;
        font-size: 1em;
        cursor: pointer;
        margin-top: 10px;
        margin-right: 5px;
    }

    button:hover {
        background-color: #a01d20;
    }

    #output {
        background-color: #f4f4f4;
        border-radius: 6px;
        padding: 10px;
        font-family: monospace;
        height: 250px;
    }

    .source-buttons {
        margin-top: 10px;
    }
</style>
</head>
<body>

<header>
    <h1>Data Acquisition Form</h1>
</header>

<main>
    <div class="section">
        <h2>General Information</h2>
        <label>Name: <input type="text" id="name" /></label>
        <label>Description: <input type="text" id="description" /></label>
        <label>Procedure Number: <input type="text" id="procedureNumber" /></label>
        <label>Facility: <input type="text" id="facility" /></label>
        <label>Location: <input type="text" id="location" /></label>
        <label>Revision: <input type="text" id="revision" /></label>
        <label>Date: <input type="date" id="date" /></label>
        <label>Origin: <input type="text" id="origin" /></label>
        <label>Machine Image: <input type="text" id="machineImage" /></label>
        <label>Isolation Points: <input type="text" id="isolationPoints" /></label>
        <label>Notes: <input type="text" id="notes" /></label>
        <label>Prepared By: <input type="text" id="preparedBy" /></label>
        <label>Approved By: <input type="text" id="approvedBy" /></label>
        <label>Approved By Company: <input type="text" id="approvedByCompany" /></label>
        <label>Completed Date: <input type="date" id="completedDate" /></label>
    </div>

    <div class="section">
        <h2>Energy Sources (max 8)</h2>
        <div id="sources"></div>
        <div class="source-buttons">
            <button type="button" onclick="addSource()">Add Source</button>
            <button type="button" onclick="removeLastSource()">Remove Source</button>
        </div>
    </div>

    <div class="section">
        <h2>Output</h2>
        <textarea id="output"></textarea>
    </div>

    <div style="margin-top: 10px;">
        <button type="button" onclick="generateJSON()">Generate JSON</button>
        <button type="button" onclick="downloadOutput()">Download JSON</button>
    </div>
</main>

<script>
let sourceCount = 0;

function addSource() {
    if (sourceCount >= 8) {
        alert("Max 8 sources allowed");
        return;
    }

    const container = document.getElementById("sources");
    const div = document.createElement("div");
    div.className = "source";
    div.innerHTML = `
        <div class="source-header">Source ${sourceCount + 1}</div>
        <label>Energy Source: <input type="text" class="EnergySource" /></label>
        <label>Chemical Name: <input type="text" class="ChemicalName" /></label>
        <label>VOLTS: <input type="text" class="VOLTS" /></label>
        <label>PSI: <input type="text" class="PSI" /></label>
        <label>LBS: <input type="text" class="LBS" /></label>
        <label>TEMP: <input type="text" class="TEMP" /></label>
        <label>Device: <input type="text" class="Device" /></label>
        <label>Tag: <input type="text" class="Tag" /></label>
        <label>Description: <input type="text" class="Description" /></label>
        <label>Isolation Point: <input type="text" class="IsolationPoint" /></label>
        <label>Isolation Method: <input type="text" class="IsolationMethod" /></label>
        <label>Verification Method: <input type="text" class="VerificationMethod" /></label>
        <label>Verification Device: <input type="text" class="VerificationDevice" /></label>
    `;
    container.appendChild(div);
    sourceCount++;
}

function removeLastSource() {
    if (sourceCount === 0) return;

    const container = document.getElementById("sources");
    const lastSource = container.lastElementChild;

    // Check if any inputs have value
    const inputs = lastSource.querySelectorAll("input");
    let hasText = false;
    inputs.forEach(input => {
        if (input.value.trim() !== "") hasText = true;
    });

    if (hasText) {
        if (!confirm("The last source contains data. Are you sure you want to remove it?")) {
            return;
        }
    }

    lastSource.remove();
    sourceCount--;
}

function generateJSON() {
    const obj = gatherData();
    document.getElementById("output").value = JSON.stringify(obj, null, 2);
}

function downloadOutput() {
    const content = document.getElementById("output").value;
    if (!content) {
        alert("Generate the JSON first!");
        return;
    }
    const filename = document.getElementById("name").value.trim() || "data";
    const blob = new Blob([content], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `${filename}.json`;
    a.click();
    URL.revokeObjectURL(url);
}

function gatherData() {
    const obj = {
        Description: getVal("description"),
        ProcedureNumber: getVal("procedureNumber"),
        Facility: getVal("facility"),
        Location: getVal("location"),
        Revision: getVal("revision"),
        Date: getVal("date"),
        Origin: getVal("origin"),
        MachineImage: getVal("machineImage"),
        IsolationPoints: getVal("isolationPoints"),
        Notes: getVal("notes"),
        ApprovedBy: getVal("approvedBy"),
        PreparedBy: getVal("preparedBy"),
        ApprovedByCompany: getVal("approvedByCompany"),
        CompletedDate: getVal("completedDate"),
        Sources: []
    };

    const sourceDivs = document.querySelectorAll(".source");
    sourceDivs.forEach(div => {
        const s = {};
        div.querySelectorAll("input").forEach(input => {
            s[input.className] = input.value;
        });
        obj.Sources.push(s);
    });

    return obj;
}

function getVal(id) {
    return document.getElementById(id).value;
}
</script>
</body>
</html>
