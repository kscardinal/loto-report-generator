<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>All Users - Admin</title>
<link rel="stylesheet" href="/static/css/user_list.css">
</head>
<body>
<header>
    <h1>All Users</h1>
</header>
<main>
    <div id="userList">
        <!-- JS will populate user cards here -->
    </div>
</main>

<script>
async function fetchUsers() {
    const response = await fetch("/users_json", {credentials: "include"});
    const data = await response.json();
    const container = document.getElementById("userList");
    container.innerHTML = "";

    data.users.forEach(user => {
        const div = document.createElement("div");
        div.classList.add("user-card"); // match the Jinja template class

        // Convert UTC timestamps to EST
        const options = {timeZone: "America/New_York", 
                         year: "numeric", month: "long", day: "numeric",
                         hour: "numeric", minute: "numeric", second: "numeric",
                         hour12: true};

        const dateCreated = user.date_created ? new Date(user.date_created) : null;
        const lastAccessed = user.last_accessed ? new Date(user.last_accessed) : null;
        const latestReset = user.latest_reset ? new Date(user.latest_reset) : null;

        const dateCreatedEST = dateCreated ? dateCreated.toLocaleString("en-US", options) : "N/A";
        const lastAccessedEST = lastAccessed ? lastAccessed.toLocaleString("en-US", options) : "N/A";
        const latestResetEST = latestReset ? latestReset.toLocaleString("en-US", options) : "N/A";

        div.innerHTML = `
            <h3>${user.username} ${user.role ? "(" + user.role + ")" : ""}</h3>
            <p><span>First Name:</span> ${user.first_name}</p>
            <p><span>Last Name:</span> ${user.last_name}</p>
            <p><span>Email:</span> ${user.email}</p>
            <p><span>Date Created:</span> ${dateCreatedEST}</p>
            <p><span>Last Accessed:</span> ${lastAccessedEST}</p>
            <p><span>Active:</span> ${user.is_active ? "Active" : "Inactive"}</p>
            <p><span>Login Attempts:</span> ${user.login_attempts || 0}</p>
            <p><span>Backup Code:</span> ${user.backup_code || "None"}</p>
            <p><span>Password Resets:</span> ${user.password_resets || 0}</p>
            <p><span>Latest Reset:</span> ${latestResetEST}</p>
            <p><span>Verification Attempts:</span> ${user.verification_attempts || 0}</p>
        `;
        container.appendChild(div);
    });
}

fetchUsers();
</script>
</body>
</html>
