<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>LOTO Generator | Report: {{ report.report_name }}</title>
    <link rel="icon" type="image/x-icon" href="/static/includes/pdf_icon.svg">
    <link rel="stylesheet" href="/static/css/view_report.css">
</head>
<body data-report-name="{{ report.report_name }}" data-redirect-url="{{ url_for('pdf_list') }}">
<header>
    <h1>Report: {{ report.report_name }}</h1>
    {% if current_user %}
        <p class="current-user">
            Logged in as: {{ current_user.username }} ({{ current_user.role|capitalize }})
        </p>
    {% endif %}
    <div class="back-div">
        <a href="{{ url_for('pdf_list') }}" class="back-btn">&#8592; Back</a>
    </div>
</header>

<main>
    <div class="content-wrapper"> 
        
        <div class="main-content-column">
            <div class="section" id="pdfSection">
                <h2>PDF</h2>
                <div id="pdfViewer" style="background:#eee; padding:10px; border-radius:8px; display:flex; flex-direction:column; align-items:center;">
                    <div id="pdfLoading">
                        <div class="loading-content">
                            <div class="spinner">
                                <svg width="24" height="24" viewBox="0 0 50 50">
                                    <circle cx="25" cy="25" r="20" fill="none" stroke="#C32026" stroke-width="5" stroke-linecap="round" stroke-dasharray="31.4 31.4" transform="rotate(0 25 25)">
                                        <animateTransform attributeName="transform" attributeType="XML" type="rotate" from="0 25 25" to="360 25 25" dur="1s" repeatCount="indefinite"/>
                                    </circle>
                                </svg>
                            </div>
                            <p>Preparing PDF viewer...</p>
                        </div>
                    </div>
                </div>
            </div>

            {% if report.photos %}
            <div class="section photos">
                <h2>Photos</h2>
                <div class="photos-container">
                    {% for photo in report.photos %}
                        <div>
                            <a href="{{ url_for('get_photo', photo_id=photo.photo_id) }}" target="_blank">
                                <img src="{{ url_for('get_photo', photo_id=photo.photo_id) }}" alt="{{ photo.photo_name }}">
                                <p>{{ photo.photo_name }}</p>
                            </a>
                        </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div> 
        
        <div class="metadata-column">
            <!-- Buttons Section (Desktop: compact sidebar, Mobile: appears above metadata) -->
            <div class="section buttons-section">
                <h2>Actions</h2>
                <div class="button-compact">
                    <a id="downloadPdfAnchor" class="download-link disabled" href="#" role="button" aria-disabled="true" data-server-href="{{ url_for('download_pdf', report_name=report.report_name) }}">Download PDF</a>
                </div>
                <div class="button-compact">
                    <button type="button" id="downloadBtn" data-report="{{ report.report_name }}" class="disabled">
                        <span id="download-button-text">Download Assets</span>
                        <span id="download-spinner-content" class="hidden-spinner">
                            Downloading...
                            <svg width="18" height="18" viewBox="0 0 50 50">
                                <circle cx="25" cy="25" r="20" fill="none" stroke="white" stroke-width="5" stroke-linecap="round" stroke-dasharray="31.4 31.4" transform="rotate(0 25 25)">
                                    <animateTransform attributeName="transform" attributeType="XML" type="rotate" from="0 25 25" to="360 25 25" dur="1s" repeatCount="indefinite"/>
                                </circle>
                            </svg>
                        </span>
                    </button>
                </div>
                <div class="button-compact">
                    <button type="button" id="renameBtn" data-report="{{ report.report_name }}" class="disabled">Rename Report</button>
                </div>
                <div class="button-compact">
                    <button type="button" id="deleteBtn" data-report="{{ report.report_name }}" class="disabled">Remove Report</button>
                </div>
            </div>
            
            <div class="section metadata full-height-container"> 
                <h2>Metadata</h2>
                <div class="inner-section">
                    <p><strong>Uploaded by:</strong> {{ report.uploaded_by }}</p>
                </div>
                <div class="inner-section">
                    <p><strong>Tags:</strong></p>
                    <ul>
                        {% for tag in report.tags %}
                            <li>{{ tag }}</li>
                        {% endfor %}
                    </ul>
                </div>
                <div class="inner-section">
                    <p><strong>Notes:</strong><br> {{ report.notes }}</p>
                </div>
                <div class="inner-section">
                    <p id="dateAdded" data-raw-date="{{ report.date_added }}"><br>...</p>
                    <div style="height: 2px; background-color: #888888; margin: 20px 40px;"></div>
                    <p id="dateModified" data-raw-date="{{ report.last_modified }}"><br>...</p>
                    <div style="height: 2px; background-color: #888888; margin: 20px 40px;"></div>
                    <p id="lastGenerated" data-raw-date="{{ report.last_generated }}"><br>...</p>
                </div>
            </div>
        </div>

    </div> 
    
    </main>

<div id="confirmModal" class="modal">
    <div id="confirmBox" class="modal-box" role="dialog" aria-modal="true" aria-labelledby="confirmText">
        <p id="confirmText"></p>
        <div class="modal-actions">
            <button id="confirmYes" class="modal-yes">Yes</button>
            <button id="confirmNo" class="modal-no">Cancel</button>
        </div>
    </div>
</div>

<!-- Rename Modal -->
<div id="renameModal" class="modal">
    <div id="renameBox" class="modal-box" role="dialog" aria-modal="true" aria-labelledby="renameTitle">
        <p id="renameTitle" style="margin: 0 0 12px 0; font-weight: bold;">Rename Report</p>
        <p id="renameOldName" style="color: #666; font-size: 0.9rem; margin: 0 0 12px 0;"></p>
        <input id="renameInput" type="text" placeholder="Enter new report name" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-family: Arial, sans-serif; font-size: 0.95rem;">
        <p id="renameError" style="color: #dc3545; font-size: 0.85rem; margin: 8px 0 0 0; display: none;"></p>
        <div class="modal-actions" style="margin-top: 16px;">
            <button id="renameYes" class="modal-yes">Rename</button>
            <button id="renameNo" class="modal-no">Cancel</button>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@4.2.67/build/pdf.worker.min.js"></script>
<script type="module" src="/static/js/view_report.js"></script>
</html>