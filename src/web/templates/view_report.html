<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>LOTO Generator | Report: {{ report.report_name }}</title>
    <link rel="icon" type="image/x-icon" href="/static/includes/pdf_icon.svg">
    <link rel="stylesheet" href="/static/css/view_report.css">
    <style>
        /* Visual state for disabled download link */
        a.download-link.disabled {
            pointer-events: none;
            opacity: 0.6;
            cursor: default;
        }
    </style>
</head>
<body data-report-name="{{ report.report_name }}" data-redirect-url="{{ url_for('pdf_list') }}">
<header>
    <h1>Report: {{ report.report_name }}</h1>
    {% if current_user %}
        <p class="current-user">
            Logged in as: {{ current_user.username }} ({{ current_user.role|capitalize }})
        </p>
    {% endif %}
    <div class="back-div">
        <a href="{{ url_for('pdf_list') }}" class="back-btn">&#8592; Back</a>
    </div>
</header>

<main>
    <div class="section metadata">
        <h2>Metadata</h2>
        <p><strong>Uploaded by:</strong> {{ report.uploaded_by }}</p>
        <p><strong>Tags:</strong></p>
        <ul>
            {% for tag in report.tags %}
                <li>{{ tag }}</li>
            {% endfor %}
        </ul>
        <p><strong>Notes:</strong> {{ report.notes }}</p>
        <p><strong>Date Added:</strong> {{ report.date_added }}</p>
        <p><strong>Last Modified:</strong> {{ report.last_modified }}</p>
        <p><strong>Last Generated:</strong> {{ report.last_generated }}</p>
    </div>

    <!-- 
    <div class="section json-data">
        <h2>JSON Data</h2>
        <pre>{{ report.json_data | tojson(indent=2) }}</pre>
    </div>
    -->

    <div class="section" id="pdfSection">
        <h2>PDF</h2>
        <div id="pdfViewer" style="background:#eee; padding:10px; border-radius:8px; display:flex; flex-direction:column; align-items:center;">
            <div id="pdfLoading">Preparing PDF viewer...</div>
        </div>
    </div>

    <div class="section photos">
        <h2>Photos</h2>
        <div class="photos-container">
            {% for photo in report.photos %}
                <div>
                    <a href="{{ url_for('get_photo', photo_id=photo.photo_id) }}" target="_blank">
                        <img src="{{ url_for('get_photo', photo_id=photo.photo_id) }}" alt="{{ photo.photo_name }}">
                        <p>{{ photo.photo_name }}</p>
                    </a>
                </div>
            {% endfor %}
        </div>
    </div>

    <div class="section download" style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <a id="downloadPdfAnchor" class="download-link disabled" href="#" role="button" aria-disabled="true" data-server-href="{{ url_for('download_pdf', report_name=report.report_name) }}">Download PDF</a>
            <button type="button" id="downloadBtn" data-report="{{ report.report_name }}">Download Assets</button>
        </div>
        <button type="button" id="deleteBtn" data-report="{{ report.report_name }}">Remove Report</button>
    </div>
</main>
<script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@4.2.67/build/pdf.worker.min.js"></script>
<script type="module" src="/static/js/view_report.js"></script>
</html>
